# Gitlab版本升级

# 一、简介

gitlab的版本规则是：`主版本(Major).次版本(Minor).补丁版本(Patch)`

- 主版本会在每年的五月22左右发布

- 次版本会在每月22号左右发布
- 补丁版本会不定时发布

版本升级说明

- 在同一个主要版本下，补丁版本和次要版本之间跳转是安全的。例如
  - `12.7.5` -> `12.10.5`
  - `11.3.4` -> `11.11.1`
  - `12.0.4` -> `12.0.12`
  - `11.11.1` -> `11.11.8`
- 而主版本升级，需要考虑版本是否可向后兼容与数据迁移，原则上先升级到当前主版本的最大次版本，然后在升级到下个主要版本最小次版本，依次往最新的版本进行升级

说明文档：

- https://docs.gitlab.com/ee/policy/maintenance.html
- https://docs.gitlab.com/ee/update/README.html#version-specific-upgrading-instructions

# 二、升级

## 1、版本升级路径

`8.11.Z` --> `8.12.0` --> `8.17.7` --> `9.5.10` --> `10.8.7` --> `11.11.8` --> `12.0.12` --> `12.1.17` --> `12.10.14` --> `13.0.14` --> `13.1.11` -- > [latest `13.Y.Z`](https://about.gitlab.com/releases/categories/releases/)

| 当前版本 | 目标版本 | 支持的版本升级路径                                           | 备注                                                         |
| :--------- | :------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| `12.9.2` | `13.4.3`   | `12.9.2` -> `12.10.14` -> `13.0.14` -> `13.4.3`              | 需要两个中间版本：最终的12.10版本以及13.0                    |
| `11.5.0` | `13.2.10`  | `11.5.0` -> `11.11.8` -> `12.0.12` -> `12.1.17` -> `12.10.14` -> `13.0.14` -> `13.2.10` | 需要五个中间版本：最终的11.11、12.0、12.1和12.10版本以及13.0 |
| `11.3.4` | `12.10.14` | `11.3.4` -> `11.11.8` -> `12.0.12` -> `12.1.17` -> `12.10.14` | 需要三个中间版本：最终的11.11和12.0版本，再加上12.1          |
| `10.4.5` | `12.9.5`   | `10.4.5` -> `10.8.7` -> `11.11.8` -> `12.0.12` -> `12.1.17` -> `12.9.5` | 需要四个中间版本：10.8、11.11、12.0和12.1，然后是12.9.5 |
| `9.2.6` | `12.2.5`   | `9.2.6` -> `9.5.10` -> `10.8.7` -> `11.11.8` -> `12.0.12` -> `12.1.17` -> `12.2.5` | 需要五个中间版本：9.5、10.8、11.11、12.0、12.1，然后是12.2。 |
| `8.13.4` | `11.3.4`   | `8.13.4` -> `8.17.7` -> `9.5.10` -> `10.8.7` -> `11.3.4`     | 8.17.7是版本8中的最新版本，9.5.10是版本9中的最新版本，10.8.7是版本10中的最新版本。 |

已实践的版本升级路线：

`11.6.1 ----> 11.11.0-ce.0(关键点) ----> 12.0.1-ce.0(关键点) ----> 12.8.0-ce.0 ----> 12.10.0(关键点) ----> 13.0.0-ce.0(关键点) ----> latest(13.8.3)`

## 2、升级步骤

升级的步骤取决于Gitlab的部署方式

- `二进制包安装`
  - 参考文档：https://docs.gitlab.com/omnibus/update/
- `源码编译安装`
  - 参考文档：https://docs.gitlab.com/ee/update/upgrading_from_source.html
- `Docker方式安装`
  - 参考文档：https://docs.gitlab.com/omnibus/docker/README.html#update
- `Helm方式安装`
  - 参考文档：https://docs.gitlab.com/charts/installation/upgrade.html#steps